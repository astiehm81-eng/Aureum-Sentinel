name: Aureum Sentinel V101.1 - Archive & Purge

on:
  schedule:
    - cron: '55 23 * * *' # TÃ¤glich kurz vor Mitternacht (UTC)
  workflow_dispatch:      # Manueller Startknopf fÃ¼r sofortige Reinigung

permissions:
  contents: write

jobs:
  archive_and_clean:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: ğŸ Setup Python 3.10
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: ğŸ“¦ Install Financial Toolkit
        run: pip install pandas pyarrow yfinance requests

      - name: ğŸ§¹ Execute Purge & Restructure
        run: |
          # Wir rufen direkt die neue V101.1 Funktion auf
          # Stelle sicher, dass move_buffer_to_heritage_v101_1() im Skript ist
          python -c "from sentinel_master import move_buffer_to_heritage_v101_1; move_buffer_to_heritage_v101_1()"
        env:
          PYTHONUNBUFFERED: 1

      - name: ğŸ›ï¸ Commit Structural Changes
        if: always()
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "Aureum Sentinel Bot"
          
          # Wir lÃ¶schen die getrackten Dateien im Root aus dem Git-Index
          # und fÃ¼gen die neuen Dekaden-Ordner hinzu
          git add heritage_vault/
          git add current_buffer.json || true
          
          # Falls Dateien gelÃ¶scht wurden, muss Git das wissen (git add -A)
          git add -A
          
          git commit -m "ğŸ›ï¸ V101.1: Decade Restructure & Root Purge Complete [$(date +'%d.%m.%Y')]" || echo "Keine Ã„nderungen nÃ¶tig"
          
          git pull --rebase origin main
          git push origin main
