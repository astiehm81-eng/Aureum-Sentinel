name: Aureum Sentinel V93 - Global Live-Sync

on:
  schedule:
    - cron: '*/10 * * * *' # Alle 10 Minuten fÃ¼r echten Live-Charakter
  workflow_dispatch: # Manueller Start jederzeit mÃ¶glich

permissions:
  contents: write

jobs:
  sentinel_sync:
    runs-on: ubuntu-latest
    timeout-minutes: 15 # Genug Puffer fÃ¼r den 100er Batch
    
    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1 # Wir brauchen nur den neuesten Stand fÃ¼r Speed

      - name: ğŸ Setup Python 3.10
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          cache: 'pip'

      - name: ğŸ“¦ Install Financial Toolkit
        run: |
          pip install --upgrade pip
          pip install pandas pyarrow yfinance requests

      - name: ğŸ›°ï¸ Run Aureum Sentinel V93
        run: python sentinel_master.py
        # Wir unterdrÃ¼cken den Error-Exit, damit der Sync-Step immer lÃ¤uft
        continue-on-error: true 

      - name: ğŸ”„ Atomic Data Sync
        if: always()
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "Aureum Sentinel Bot"
          
          # HinzufÃ¼gen der neuen Parquet-Daten und des aktualisierten Pools
          git add isin_pool.json vault_status.txt heritage_vault/*.parquet || true
          
          # Commit nur wenn sich wirklich etwas geÃ¤ndert hat
          git commit -m "âš¡ Live-Sync & Expansion Update [$(date +'%Y-%m-%d %H:%M')]" || echo "Keine Ã„nderungen"
          
          # Rebase um Konflikte bei schnellen Intervallen zu vermeiden
          git pull --rebase origin main
          git push origin main
